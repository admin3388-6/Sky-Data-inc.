<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Emergency Mode</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; }
        body { background-color: #0a0a12; color: white; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; overflow: hidden; }
        .login-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 30px; border-radius: 24px; width: 90%; max-width: 400px; text-align: center; }
        
        .social-btn { width: 100%; height: 50px; margin-bottom: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; color: white; opacity: 0.5; pointer-events: none; }
        .social-btn.active { opacity: 1; pointer-events: all; }
        .btn-google { background: #db4437; } .btn-linkedin { background: #0077b5; } .btn-github { background: #24292e; }

        /* ÿ≤ÿ± ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ */
        #fixBtn { background: red; color: white; border: none; padding: 15px; width: 100%; border-radius: 50px; font-weight: bold; margin-bottom: 20px; cursor: pointer; box-shadow: 0 0 20px red; }
    </style>

    <script>
        window.cfToken=null;
        function onSuccess(t){ 
            window.cfToken=t; 
            document.querySelectorAll('.social-btn').forEach(b => b.classList.add('active')); 
        }
    </script>
</head>
<body>

    <div class="login-card">
        <button id="fixBtn">‚ö†Ô∏è CLICK HERE TO FIX LOOP ‚ö†Ô∏è</button>

        <h2 style="margin-bottom:20px;">Login</h2>
        <div style="margin: 20px 0; display:flex; justify-content:center;">
            <div class="cf-turnstile" data-sitekey="0x4AAAAAACDn9I1izJuNt20l" data-callback="onSuccess" data-theme="dark"></div>
        </div>

        <button id="googleBtn" class="social-btn btn-google"><i class="fab fa-google"></i> Google</button>
        <button id="linkedinBtn" class="social-btn btn-linkedin"><i class="fab fa-linkedin"></i> LinkedIn</button>
        <button id="githubBtn" class="social-btn btn-github"><i class="fab fa-github"></i> GitHub</button>
    </div>
    
    <script type="module">
        import { supabase } from "./supabase.js";

        // üõë 1. ŸÉŸàÿØ ÿßŸÑÿ•ÿµŸÑÿßÿ≠ ÿßŸÑŸäÿØŸàŸä (ÿßÿ∂ÿ∫ÿ∑ ÿßŸÑÿ≤ÿ± ÿßŸÑÿ£ÿ≠ŸÖÿ± ŸÑÿ™ÿπŸÖŸÑ)
        document.getElementById('fixBtn').onclick = async () => {
            localStorage.clear(); // ŸÖÿ≥ÿ≠ ŸÉŸÑ ÿ¥Ÿäÿ° ŸÅŸä ÿßŸÑŸÖÿ™ÿµŸÅÿ≠
            await supabase.auth.signOut(); // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿÆÿ±Ÿàÿ¨ ÿ•ÿ¨ÿ®ÿßÿ±Ÿä
            alert("System Reset! Now try to login.");
            window.location.reload();
        };

        // 2. ÿßŸÑÿØÿÆŸàŸÑ (ÿ®ÿØŸàŸÜ ÿ£Ÿä ÿ™ÿ≠ŸàŸäŸÑ ÿ™ŸÑŸÇÿßÿ¶Ÿä)
        async function login(p) {
            if(!window.cfToken) { alert("Please do the captcha"); return; }
            
            const { error } = await supabase.auth.signInWithOAuth({ 
                provider: p, 
                options: { redirectTo: window.location.origin + "/menu.html" } 
            });
            if(error) alert(error.message);
        }
        
        document.getElementById('googleBtn').onclick = () => login('google');
        document.getElementById('linkedinBtn').onclick = () => login('linkedin_oidc');
        document.getElementById('githubBtn').onclick = () => login('github');
    </script>
</body>
</html>