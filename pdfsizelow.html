<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>ğŸ—œï¸ SkyData PDF Compressor PRO</title>
<style>
body { margin:0; font-family:Arial; text-align:center; direction:rtl; background:#f0f2f5;}
.card { margin:40px auto; width:90%; max-width:480px; background:white; padding:25px; border-radius:18px; box-shadow:0 4px 15px rgba(0,0,0,.12);}
input, select, button { margin:10px 0; padding:10px; width:90%; font-size:16px; border-radius:8px; border:1px solid #bbb;}
button { cursor:pointer; background:#2979ff; color:white; border:none; border-radius:10px;}
button:hover{background:#1565c0;}
#progress-container { width:100%; background:#d0d7de; height:28px; border-radius:12px; margin-top:15px; overflow:hidden; display:none;}
#progress-bar { width:0%; height:100%; background:linear-gradient(90deg,#2196F3,#42a5f5); transition:width .15s linear;}
#status { font-weight:bold; margin-top:10px; }
#eta { margin-top:5px; color:#555; }
#results { margin-top:10px; font-size:14px; }
#download-btn { display:none; margin-top:15px; padding:10px 20px; font-size:16px; background:#28a745; color:white; border:none; border-radius:10px; cursor:pointer; }
#download-btn:hover{background:#218838;}
</style>
</head>
<body>
<div class="card">
<h2>ğŸ—œï¸ SkyData PDF Compressor PRO</h2>
<input type="file" id="file" accept="application/pdf">
<select id="quality">
<option value="high">Ø¹Ø§Ù„ÙŠ</option>
<option value="medium">Ù…ØªÙˆØ³Ø·</option>
<option value="low">Ø§Ù‚ØªØµØ§Ø¯ÙŠ</option>
</select>
<button onclick="uploadFile()">Ø¶ØºØ· Ø§Ù„Ù…Ù„Ù</button>

<div id="progress-container"><div id="progress-bar"></div></div>
<div id="status"></div>
<div id="eta"></div>
<div id="results"></div>
<button id="download-btn">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¶ØºÙˆØ·</button>
</div>

<script>
let compressedBlob = null;

function formatTime(s){
  if(s<60) return `${s.toFixed(1)} Ø«Ø§Ù†ÙŠØ©`;
  if(s<3600) return `${(s/60).toFixed(1)} Ø¯Ù‚ÙŠÙ‚Ø©`;
  return `${(s/3600).toFixed(1)} Ø³Ø§Ø¹Ø©`;
}

async function uploadFile(){
  const fileInput = document.getElementById('file');
  const file = fileInput.files[0];
  const quality = document.getElementById('quality').value;
  const progress = document.getElementById('progress-container');
  const bar = document.getElementById('progress-bar');
  const status = document.getElementById('status');
  const eta = document.getElementById('eta');
  const results = document.getElementById('results');
  const downloadBtn = document.getElementById('download-btn');

  if(!file){alert("Ø§Ø®ØªØ± Ù…Ù„Ù PDF"); return;}
  if(file.size > 40*1024*1024){alert("âŒ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ø£ÙƒØ¨Ø± Ù…Ù† 40MB"); return;}

  progress.style.display='block';
  bar.style.width='0%';
  status.innerText="â³ Ø¨Ø¯Ø¡ Ø±ÙØ¹ ÙˆØ¶ØºØ· Ø§Ù„Ù…Ù„Ù...";
  eta.innerText="";
  results.innerHTML="";
  downloadBtn.style.display='none';

  const formData = new FormData();
  formData.append('file', file);
  formData.append('quality', quality);

  const start = performance.now();
  try {
    const res = await fetch('https://size-pdf-production.up.railway.app/compress', {method:'POST', body:formData});
    if(!res.ok){ alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¶ØºØ·"); return; }

    const blob = await res.blob();
    const elapsed = (performance.now()-start)/1000;
    eta.innerText=`â±ï¸ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³ØªØºØ±Ù‚: ${formatTime(elapsed)}`;

    const origMB = (file.size/1024/1024).toFixed(2);
    const newMB = (blob.size/1024/1024).toFixed(2);
    const saved = ((file.size-blob.size)/file.size*100).toFixed(1);

    results.innerHTML=`<p>ğŸ“„ ${file.name}: <span style="color:red;">${origMB}MB</span> â†’ <span style="color:green;">${newMB}MB</span> | ØªÙ… Ø¥Ø²Ø§Ù„Ø© ${saved}%</p>`;
    compressedBlob = blob;

    bar.style.width='100%';
    status.innerText="âœ… ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡!";
    downloadBtn.style.display='inline-block';
    downloadBtn.onclick = function(){
      const url = URL.createObjectURL(compressedBlob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `skydata_${file.name}`;
      a.click();
      URL.revokeObjectURL(url);
    };
  } catch(err){
    console.error(err);
    results.innerHTML="<p style='color:red'>âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¶ØºØ·</p>";
  }
}
</script>
</body>
</html>