<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sky Data - Ø¯Ù…Ø¬ Ù…Ù„ÙØ§Øª PDF</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --bg-dark: #0a0a12; --border: rgba(255, 255, 255, 0.1); --primary: #4e54c8; --accent: #00d2ff; --text: #ffffff; --glass: rgba(20, 20, 30, 0.7); }
        body { background-color: var(--bg-dark); color: var(--text); font-family: 'Cairo', sans-serif; overflow-x: hidden; margin: 0; padding: 20px; }
        #canvas-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; }
        
        .header { display: flex; justify-content: space-between; margin-bottom: 40px; }
        .back-btn { text-decoration: none; color: var(--text); background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 20px; transition: 0.3s; }
        .back-btn:hover { background: var(--primary); }

        .container { max-width: 600px; margin: 0 auto; background: var(--glass); padding: 40px; border-radius: 20px; border: 1px solid var(--border); backdrop-filter: blur(10px); text-align: center; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        
        h2 { color: var(--accent); margin-bottom: 20px; }
        
        .upload-box { border: 2px dashed var(--border); padding: 30px; border-radius: 15px; cursor: pointer; transition: 0.3s; margin-bottom: 20px; position: relative; }
        .upload-box:hover { border-color: var(--accent); background: rgba(0, 210, 255, 0.05); }
        .upload-box i { font-size: 40px; color: var(--primary); margin-bottom: 10px; }
        input[type="file"] { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

        select { width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid var(--border); color: white; border-radius: 8px; margin-bottom: 20px; font-family: 'Cairo'; }
        option { background: #111; }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 16px; margin-top: 10px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #3b42b6; }
        .btn-success { background: #00e676; color: black; display: none; }
        
        #progress-container { width: 100%; background: #222; border-radius: 10px; height: 10px; margin-top: 20px; overflow: hidden; display: none; }
        #progress-bar { height: 100%; width: 0%; background: var(--accent); transition: width 0.3s; box-shadow: 0 0 10px var(--accent); }
        
        #status { margin-top: 15px; font-size: 14px; color: #ccc; }
    </style>
</head>
<body>
    <canvas id="canvas-bg"></canvas>
    
    <div class="header">
        <a href="pdftools.html" class="back-btn"><i class="fas fa-arrow-right"></i> Ø±Ø¬ÙˆØ¹</a>
    </div>

    <div class="container">
        <h2><i class="fas fa-layer-group"></i> Ø¯Ù…Ø¬ Ù…Ù„ÙØ§Øª PDF</h2>
        
        <div class="upload-box">
            <i class="fas fa-cloud-upload-alt"></i>
            <p>Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„ÙØ§Øª Ø£Ùˆ Ø§Ø³Ø­Ø¨Ù‡Ø§ Ù‡Ù†Ø§</p>
            <input type="file" id="files" multiple accept="application/pdf">
        </div>

        <select id="quality">
            <option value="high">Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹</option>
            <option value="medium">Ø¬ÙˆØ¯Ø© Ù…ØªÙˆØ³Ø·Ø© (Ø£Ø³Ø±Ø¹)</option>
            <option value="low">Ø­Ø¬Ù… Ø§Ù‚ØªØµØ§Ø¯ÙŠ (Ø£ØµØºØ±)</option>
        </select>

        <button class="btn btn-primary" onclick="mergePDFs()"><i class="fas fa-bolt"></i> Ø¯Ù…Ø¬ Ø§Ù„Ù…Ù„ÙØ§Øª</button>

        <div id="progress-container"><div id="progress-bar"></div></div>
        <div id="status"></div>
        <div id="eta"></div>

        <button id="download-btn" class="btn btn-success" onclick="downloadMerged()">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø¯Ù…ÙˆØ¬</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
    <script>
        // ÙƒÙˆØ¯ Ø§Ù„Ø®Ù„ÙÙŠØ©
        const c=document.getElementById('canvas-bg'),x=c.getContext('2d');let w,h,p=[];function r(){w=c.width=window.innerWidth;h=c.height=window.innerHeight}window.addEventListener('resize',r);r();class P{constructor(){this.x=Math.random()*w;this.y=Math.random()*h;this.vx=(Math.random()-0.5)*0.5;this.vy=(Math.random()-0.5)*0.5;this.size=Math.random()*2}u(){this.x+=this.vx;this.y+=this.vy;if(this.x<0||this.x>w)this.vx*=-1;if(this.y<0||this.y>h)this.vy*=-1}d(){x.fillStyle='rgba(140,155,255,0.3)';x.beginPath();x.arc(this.x,this.y,this.size,0,Math.PI*2);x.fill()}}for(let i=0;i<60;i++)p.push(new P());function a(){x.clearRect(0,0,w,h);p.forEach(e=>{e.u();e.d()});requestAnimationFrame(a)}a();

        // Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¯Ù…Ø¬
        let mergedBlob = null;
        const MAX_FILES = 20; const MAX_SIZE_MB = 200;
        
        async function mergePDFs() {
            const files = document.getElementById("files").files;
            if (files.length < 2) { alert("âš ï¸ Ø§Ø®ØªØ± Ù…Ù„ÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„."); return; }

            document.getElementById("progress-container").style.display = "block";
            const bar = document.getElementById("progress-bar");
            const status = document.getElementById("status");
            const downloadBtn = document.getElementById("download-btn");
            downloadBtn.style.display = "none";

            const { PDFDocument } = PDFLib;
            const mergedPdf = await PDFDocument.create();
            
            for (let i = 0; i < files.length; i++) {
                status.innerText = `ğŸ”„ Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù ${i + 1} Ù…Ù† ${files.length}...`;
                bar.style.width = `${((i + 1) / files.length) * 100}%`;
                
                const buffer = await files[i].arrayBuffer();
                const pdf = await PDFDocument.load(buffer);
                const pages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                pages.forEach(p => mergedPdf.addPage(p));
            }

            status.innerText = "ğŸ“¦ Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ...";
            const mergedBytes = await mergedPdf.save();
            mergedBlob = new Blob([mergedBytes], { type: "application/pdf" });

            status.innerText = "âœ… ØªÙ… Ø§Ù„Ø¯Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­!";
            downloadBtn.style.display = "block";
        }

        function downloadMerged() {
            if (!mergedBlob) return;
            const url = URL.createObjectURL(mergedBlob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "skydata_merged.pdf";
            a.click();
        }
    </script>
</body>
</html>