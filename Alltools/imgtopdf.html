<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Sky Data - ØµÙˆØ± Ø¥Ù„Ù‰ PDF</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --bg-dark: #0a0a12; --glass: rgba(20, 20, 30, 0.8); --border: rgba(255, 255, 255, 0.1); --primary: #ff4b4b; --text: #fff; }
        body { background: var(--bg-dark); color: var(--text); font-family: 'Cairo'; margin: 0; padding: 20px; }
        #canvas-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; }
        
        .header { margin-bottom: 30px; }
        .back-btn { text-decoration: none; color: white; background: rgba(255,255,255,0.1); padding: 8px 15px; border-radius: 20px; }

        .container { max-width: 800px; margin: 0 auto; background: var(--glass); padding: 40px; border-radius: 20px; border: 1px solid var(--border); backdrop-filter: blur(10px); }
        
        .upload-area { border: 2px dashed #555; padding: 40px; border-radius: 15px; text-align: center; cursor: pointer; transition: 0.3s; margin-bottom: 30px; }
        .upload-area:hover { border-color: var(--primary); background: rgba(255, 75, 75, 0.05); }
        
        .controls { display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; }
        select, input { padding: 12px; background: #111; border: 1px solid #444; color: white; border-radius: 8px; flex: 1; }
        
        .btn { padding: 15px 30px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; color: white; font-size: 16px; transition: 0.3s; width: 100%; margin-top: 10px; }
        .btn-primary { background: var(--primary); box-shadow: 0 0 15px rgba(255, 75, 75, 0.3); }
        .btn-preview { background: #4e54c8; }
        
        .progress-bar { height: 8px; background: #333; margin-top: 20px; border-radius: 4px; overflow: hidden; display: none; }
        .fill { height: 100%; width: 0%; background: var(--primary); transition: width 0.3s; }
        
        /* Modal for preview */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; align-items: center; justify-content: center; }
        .modal-content { background: #1a1a1a; padding: 20px; border-radius: 15px; max-width: 90%; max-height: 90%; overflow-y: auto; text-align: center; }
        .preview-grid { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .preview-item { width: 100px; background: #222; padding: 5px; border-radius: 5px; }
        .preview-item img { width: 100%; border-radius: 4px; }
        .close-modal { position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; cursor: pointer; }
    </style>
</head>
<body>
    <canvas id="canvas-bg"></canvas>
    <div class="header"><a href="pdftools.html" class="back-btn">Ø±Ø¬ÙˆØ¹</a></div>

    <div class="container">
        <h2 style="text-align:center; color:var(--primary)">ğŸ–¼ï¸ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ PDF</h2>
        
        <div class="upload-area" onclick="document.getElementById('imageUpload').click()">
            <i class="fas fa-images" style="font-size:50px; color:#fff; margin-bottom:15px;"></i>
            <p>Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ± (JPG, PNG)</p>
            <input type="file" id="imageUpload" multiple accept="image/*" style="display:none">
        </div>
        <p id="fileCount" style="text-align:center; color:#888;"></p>

        <div class="controls">
            <select id="pageFormat">
                <option value="A4">Ø­Ø¬Ù… A4 (Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ)</option>
                <option value="Letter">Ø­Ø¬Ù… Ø±Ø³Ø§Ù„Ø© (Letter)</option>
            </select>
            <select id="imageQuality">
                <option value="1.0">Ø¯Ù‚Ø© ÙƒØ§Ù…Ù„Ø© (100%)</option>
                <option value="0.8" selected>Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© (80%)</option>
                <option value="0.6">Ø¯Ù‚Ø© Ù…ØªÙˆØ³Ø·Ø© (60%)</option>
            </select>
        </div>

        <button class="btn btn-preview" onclick="showPreview()">ğŸ‘ï¸ Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØªØ¯ÙˆÙŠØ±</button>
        <button class="btn btn-primary" id="convertBtn">ğŸš€ ØªØ­ÙˆÙŠÙ„ ÙˆØªÙ†Ø²ÙŠÙ„</button>

        <div class="progress-bar"><div class="fill" id="fill"></div></div>
        <div id="status" style="text-align:center; margin-top:15px; color:#aaa;"></div>
    </div>

    <div class="modal" id="previewModal">
        <span class="close-modal" onclick="document.getElementById('previewModal').style.display='none'">&times;</span>
        <div class="modal-content">
            <h3>Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</h3>
            <div class="preview-grid" id="previewGrid"></div>
        </div>
    </div>

    <script>
        // Ø§Ù„Ø®Ù„ÙÙŠØ©
        const c=document.getElementById('canvas-bg'),x=c.getContext('2d');let w,h,p=[];function r(){w=c.width=window.innerWidth;h=c.height=window.innerHeight}window.addEventListener('resize',r);r();class P{constructor(){this.x=Math.random()*w;this.y=Math.random()*h;this.vx=(Math.random()-0.5)*0.5;this.vy=(Math.random()-0.5)*0.5;this.size=Math.random()*2}u(){this.x+=this.vx;this.y+=this.vy;if(this.x<0||this.x>w)this.vx*=-1;if(this.y<0||this.y>h)this.vy*=-1}d(){x.fillStyle='rgba(140,155,255,0.3)';x.beginPath();x.arc(this.x,this.y,this.size,0,Math.PI*2);x.fill()}}for(let i=0;i<60;i++)p.push(new P());function a(){x.clearRect(0,0,w,h);p.forEach(e=>{e.u();e.d()});requestAnimationFrame(a)}a();

        let selectedFiles = [];
        
        document.getElementById('imageUpload').addEventListener('change', (e) => {
            selectedFiles = Array.from(e.target.files);
            document.getElementById('fileCount').innerText = `ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${selectedFiles.length} ØµÙˆØ±Ø©`;
        });

        function showPreview() {
            if(selectedFiles.length === 0) return alert("Ø§Ø®ØªØ± ØµÙˆØ±Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹");
            const grid = document.getElementById('previewGrid');
            grid.innerHTML = '';
            document.getElementById('previewModal').style.display = 'flex';
            
            selectedFiles.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const div = document.createElement('div');
                    div.className = 'preview-item';
                    div.innerHTML = `<img src="${e.target.result}">`;
                    grid.appendChild(div);
                }
                reader.readAsDataURL(file);
            });
        }

        document.getElementById('convertBtn').addEventListener('click', async () => {
            if(selectedFiles.length === 0) return alert("Ø§Ø®ØªØ± ØµÙˆØ±Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹");
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ format: document.getElementById('pageFormat').value });
            const quality = parseFloat(document.getElementById('imageQuality').value);
            const bar = document.getElementById('fill');
            const status = document.getElementById('status');
            
            document.querySelector('.progress-bar').style.display = 'block';

            for(let i=0; i<selectedFiles.length; i++) {
                status.innerText = `Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø© ${i+1}...`;
                bar.style.width = `${((i+1)/selectedFiles.length)*100}%`;
                
                const imgData = await readFile(selectedFiles[i]);
                const imgProps = doc.getImageProperties(imgData);
                const pdfWidth = doc.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
                
                if(i > 0) doc.addPage();
                doc.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight, undefined, 'FAST');
            }
            
            status.innerText = "âœ… ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„! Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†Ø²ÙŠÙ„...";
            doc.save("skydata_images.pdf");
        });

        function readFile(file) {
            return new Promise(resolve => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>