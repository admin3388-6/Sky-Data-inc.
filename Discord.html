<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Sky Data Elite Control</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --accent: #00d2ff; --bg: #050608; --card: #11141a; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; padding: 30px; }
        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card); padding: 20px; border-radius: 15px; text-align: center; border-bottom: 3px solid var(--accent); }
        .main-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        .panel { background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid #222; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn-upload { background: #e67e22; color: white; }
        .btn-save { background: var(--accent); color: #000; }
        input, select, textarea { width: 100%; padding: 12px; background: #1a1e26; border: 1px solid #333; color: white; border-radius: 10px; margin-top: 8px; }
        .preview-img { width: 100%; border-radius: 10px; margin-top: 15px; border: 1px dashed #444; }
    </style>
</head>
<body>

    <div class="stat-grid">
        <div class="stat-card"><h3 id="memberCount">0</h3><p>إجمالي الأعضاء</p></div>
        <div class="stat-card"><h3>متصل</h3><p>حالة البوت</p></div>
        <div class="stat-card"><h3>نشط</h3><p>نظام الحماية</p></div>
    </div>

    <div class="main-grid">
        <div class="panel">
            <h2><i class="fas fa-camera"></i> اختبار صورة الترحيب (ImgBB)</h2>
            <label>ارفع صورة جديدة للاختبار:</label>
            <input type="file" id="imageFile" accept="image/*">
            <button class="btn btn-upload" onclick="uploadImage()"><i class="fas fa-cloud-upload-alt"></i> رفع واختبار</button>
            <img id="currentPreview" src="" class="preview-img" alt="معاينة الخلفية">
            
            <label style="margin-top:15px;">قناة الترحيب:</label>
            <select id="welcomeCh"></select>
            <button class="btn btn-save" onclick="saveSettings()">حفظ الإعدادات</button>
        </div>

        <div class="panel">
            <h2><i class="fas fa-paper-plane"></i> مركز الإرسال والردود</h2>
            <label>قناة الإرسال:</label>
            <select id="targetCh"></select>
            
            <div style="background:#1a1e26; padding:15px; border-radius:10px; margin-top:15px;">
                <h4>إرسال سريع (عادي):</h4>
                <textarea id="normalText" rows="2" placeholder="اكتب رسالتك هنا..."></textarea>
                <button class="btn" style="background:#2ecc71; color:white;" onclick="send('normal')">إرسال نصي</button>
            </div>

            <div style="background:#1a1e26; padding:15px; border-radius:10px; margin-top:15px;">
                <h4>إيمباد احترافي:</h4>
                <input type="text" id="embTitle" placeholder="العنوان">
                <textarea id="embDesc" rows="2" placeholder="الوصف"></textarea>
                <input type="color" id="embColor" value="#00d2ff">
                <button class="btn btn-save" onclick="send('embed')">إرسال إيمباد</button>
            </div>
        </div>
    </div>

<script>
    const API_URL = "https://2k-discord-bot-production.up.railway.app";
    const IMGBB_KEY = "f0ff703738276bb67fcc6b7f0a6778d5";

    async function uploadImage() {
        const file = document.getElementById('imageFile').files[0];
        if(!file) return alert("اختر صورة أولاً");
        
        const formData = new FormData();
        formData.append("image", file);
        
        const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: "POST", body: formData });
        const data = await res.json();
        const url = data.data.url;
        
        document.getElementById('currentPreview').src = url;
        // تحديث البوت بالصورة الجديدة فوراً
        await fetch(`${API_URL}/api/update`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ welcome_bg: url })
        });
        alert("تم رفع الصورة وتحديث خلفية البوت!");
    }

    async function send(type) {
        const data = {
            channel_id: document.getElementById('targetCh').value,
            type: type,
            content: document.getElementById('normalText').value,
            title: document.getElementById('embTitle').value,
            desc: document.getElementById('embDesc').value,
            color: document.getElementById('embColor').value
        };
        await fetch(`${API_URL}/api/send`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
        alert("تم الإرسال!");
    }

    async function saveSettings() {
        const data = { welcome_ch: document.getElementById('welcomeCh').value };
        await fetch(`${API_URL}/api/update`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
        alert("تم حفظ القناة!");
    }

    async function init() {
        const res = await fetch(`${API_URL}/api/status`);
        const data = await res.json();
        document.getElementById('memberCount').innerText = data.members;
        document.getElementById('currentPreview').src = data.current_bg;
        const opts = data.channels.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
        document.getElementById('welcomeCh').innerHTML = opts;
        document.getElementById('targetCh').innerHTML = opts;
    }
    init();
</script>
</body>
</html>
