<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Sky Data | Pro Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: #0a0b10; color: white; font-family: sans-serif; margin: 0; display: flex; }
        .sidebar { width: 260px; background: #11141d; height: 100vh; padding: 20px; border-left: 1px solid #222; }
        .main { flex: 1; padding: 40px; }
        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .stat-card { background: #1a1e29; padding: 25px; border-radius: 15px; border-bottom: 4px solid #00d2ff; }
        .panel { background: #1a1e29; padding: 25px; border-radius: 20px; margin-top: 30px; }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-primary { background: #00d2ff; color: #000; }
        input, select { width: 100%; padding: 12px; background: #0a0b10; border: 1px solid #333; color: white; border-radius: 10px; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2><i class="fas fa-robot"></i> Sky Data</h2>
        <p><i class="fas fa-check-circle" style="color: #2ed573;"></i> البوت نشط الآن</p>
    </div>

    <div class="main">
        <h1>الإحصائيات الحية</h1>
        <div class="stat-grid">
            <div class="stat-card"><h3>الأعضاء</h3><h2 id="membersCount">0</h2></div>
            <div class="stat-card"><h3>متصلون</h3><h2 id="onlineCount">0</h2></div>
            <div class="stat-card"><h3>سيرفرات</h3><h2 id="serversCount">0</h2></div>
        </div>

        <div class="panel">
            <h2><i class="fas fa-image"></i> إعدادات الترحيب والصورة</h2>
            <label>ارفع صورة الخلفية (ImgBB):</label>
            <input type="file" id="imageInput">
            <button class="btn btn-primary" onclick="uploadImg()">رفع وتحديث الصورة</button>
            
            <label style="display:block; margin-top:20px;">اختيار قناة الترحيب:</label>
            <select id="welcomeChSelect"></select>
            <button class="btn btn-primary" onclick="saveConfig()">حفظ القناة</button>
        </div>
    </div>

<script>
    const API = "https://2k-discord-bot-production.up.railway.app";
    const BB_KEY = "f0ff703738276bb67fcc6b7f0a6778d5";

    async function uploadImg() {
        const file = document.getElementById('imageInput').files[0];
        const formData = new FormData();
        formData.append("image", file);
        const res = await fetch(`https://api.imgbb.com/1/upload?key=${BB_KEY}`, { method: "POST", body: formData });
        const data = await res.json();
        const url = data.data.url;
        await fetch(`${API}/api/update`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ bg: url }) });
        alert("تم تحديث صورة الترحيب!");
    }

    async function saveConfig() {
        const ch = document.getElementById('welcomeChSelect').value;
        await fetch(`${API}/api/update`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ welcome_ch: ch }) });
        alert("تم الحفظ!");
    }

    async function loadStats() {
        const res = await fetch(`${API}/api/stats`);
        const data = await res.json();
        document.getElementById('membersCount').innerText = data.members;
        document.getElementById('onlineCount').innerText = data.online;
        document.getElementById('serversCount').innerText = data.servers;
        document.getElementById('welcomeChSelect').innerHTML = data.channels.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
    }

    loadStats();
    setInterval(loadStats, 10000);
</script>
</body>
</html>
