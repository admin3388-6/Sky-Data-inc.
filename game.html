<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Arcade Zone</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- Global Styles --- */
        :root { --bg-dark: #0a0a12; --glass: rgba(255, 255, 255, 0.03); --border: rgba(255, 255, 255, 0.08); --primary: #4e54c8; --accent: #00d2ff; --text: #ffffff; --text-muted: #8b9bb4; --shield-color: #00f2ff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; user-select: none; }
        body { background-color: var(--bg-dark); color: var(--text); overflow-x: hidden; }
        #canvas-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.5; }

        /* Header */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 20px 30px; background: rgba(10, 10, 18, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border); position: fixed; top: 0; width: 100%; z-index: 100; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .xp-display { background: rgba(0, 210, 255, 0.1); color: var(--accent); padding: 5px 15px; border-radius: 20px; font-weight: bold; border: 1px solid rgba(0, 210, 255, 0.2); font-size: 14px; }

        /* Unsaved Points Alert */
        .unsaved-alert {
            position: fixed; top: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 165, 0, 0.2); border: 1px solid orange; color: orange;
            padding: 10px 20px; border-radius: 50px; font-size: 14px; z-index: 99;
            display: none; animation: pulse 2s infinite; cursor: pointer;
        }
        .unsaved-alert:hover { background: rgba(255, 165, 0, 0.4); }

        /* Main Menu */
        .main-content { margin-top: 100px; padding: 20px; display: flex; flex-direction: column; align-items: center; gap: 30px; }
        .game-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; width: 100%; max-width: 900px; }
        .game-card { background: var(--glass); border: 1px solid var(--border); padding: 30px; border-radius: 24px; text-align: center; transition: 0.3s; cursor: pointer; position: relative; overflow: hidden; }
        .game-card:hover { transform: translateY(-10px); border-color: var(--accent); box-shadow: 0 10px 30px rgba(0, 210, 255, 0.1); }
        .game-icon { font-size: 50px; color: var(--accent); margin-bottom: 20px; }
        .play-btn { margin-top: 20px; padding: 10px 30px; background: var(--primary); color: white; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; }

        /* Game Modal */
        .game-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 2000; display: none; flex-direction: column; }
        .game-hud { position: absolute; top: 20px; left: 20px; color: white; font-family: 'Courier New', monospace; z-index: 2002; pointer-events: none; }
        .game-hud div { margin-bottom: 8px; text-shadow: 0 2px 4px black; font-size: 18px; font-weight: bold; }
        .close-game { position: absolute; top: 20px; right: 20px; background: rgba(255,0,0,0.3); color: white; border: 1px solid red; padding: 8px 20px; border-radius: 10px; cursor: pointer; z-index: 2002; }
        
        canvas#gameCanvas { width: 100%; height: 100%; display: block; touch-action: none; cursor: none; }

        /* Game Over */
        .game-over-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); z-index: 2003; display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; backdrop-filter: blur(10px); }
        .score-result { font-size: 1.5rem; color: white; margin-bottom: 10px; }
        .xp-gained { font-size: 1.2rem; color: var(--accent); margin-bottom: 30px; }
        .total-pending { color: orange; font-size: 14px; margin-bottom: 30px; border: 1px dashed orange; padding: 5px 15px; border-radius: 20px; }
        
        .action-btn { padding: 15px 40px; font-size: 18px; border-radius: 50px; border: none; cursor: pointer; margin: 10px; font-weight: bold; transition: 0.3s; min-width: 200px; }
        .btn-save { background: #00c853; color: white; box-shadow: 0 0 20px rgba(0, 200, 83, 0.4); }
        .btn-retry { background: transparent; border: 2px solid white; color: white; }
        .btn-save:hover { transform: scale(1.05); }

        @keyframes pulse { 0%, 100% { opacity: 1; transform: translateX(-50%) scale(1); } 50% { opacity: 0.8; transform: translateX(-50%) scale(0.98); } }
        @media (max-width: 600px) { .header { padding: 15px; } .xp-display { display: none; } }
    </style>
</head>
<body>

    <canvas id="canvas-bg"></canvas>

    <div class="header">
        <div style="font-size: 24px; font-weight: bold; color: white;">SKY <span style="color:var(--accent)">ARCADE</span></div>
        <div class="user-info">
            <div class="xp-display"><i class="fas fa-bolt"></i> <span id="headerXp">0</span></div>
            <div id="userName" style="font-weight:bold">User</div>
        </div>
    </div>

    <div id="unsavedAlert" class="unsaved-alert" onclick="forceSave()">
        ‚ö†Ô∏è You have <span id="unsavedVal">0</span> Unsaved XP! Click to Save.
    </div>

    <div class="main-content">
        <div class="game-grid">
            <div class="game-card" onclick="startGame('rocket')">
                <div class="game-icon"><i class="fas fa-rocket"></i></div>
                <h3>Space Dodge</h3>
                <p>Navigate asteroid fields. Collect Energy.</p>
                <div style="margin-top:10px; font-size:12px; color:#aaa;">Best: <span id="rocketHigh">0</span></div>
                <button class="play-btn">Launch</button>
            </div>
            <div class="game-card" onclick="startGame('snake')">
                <div class="game-icon"><i class="fas fa-dragon"></i></div>
                <h3>Neon Snake</h3>
                <p>Classic snake. Consume fuel cells.</p>
                <div style="margin-top:10px; font-size:12px; color:#aaa;">Best: <span id="snakeHigh">0</span></div>
                <button class="play-btn">Start</button>
            </div>
        </div>
        <button onclick="window.location.href='menu.html'" style="margin-top:30px; background:transparent; border:1px solid #555; color:#888; padding:10px 20px; border-radius:20px; cursor:pointer;">Back to Dashboard</button>
    </div>

    <div class="game-modal" id="gameModal">
        <div class="game-hud">
            <div>üöÄ SCORE: <span id="gameScore" style="color:#00e676">0</span></div>
            <div>‚ö° XP: <span id="gameXP" style="color:var(--accent)">0</span></div>
            <div id="shieldStatus" style="color:var(--shield-color); display:none; text-shadow: 0 0 10px var(--shield-color);">üõ°Ô∏è SHIELD ACTIVE</div>
        </div>
        <button class="close-game" onclick="exitGame()">ABORT</button>
        <canvas id="gameCanvas"></canvas>

        <div id="startOverlay" style="position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; flex-direction:column; justify-content:center; align-items:center; color:white; z-index:2001; cursor:pointer;" onclick="initGameLogic()">
            <i class="fas fa-play-circle" style="font-size:60px; margin-bottom:20px; color:var(--accent);"></i>
            <div style="font-size:24px; font-weight:bold;">TAP TO START</div>
        </div>

        <div class="game-over-screen" id="gameOverScreen">
            <h1 style="color:#ff4b4b; text-shadow: 0 0 20px red;">CRITICAL FAILURE</h1>
            <div class="score-result">Round Score: <span id="finalScore">0</span></div>
            <div class="xp-gained">Gained: +<span id="finalXP">0</span> XP</div>
            
            <div class="total-pending">
                üì¶ Total Unsaved in Vault: <span id="vaultXP">0</span> XP
            </div>

            <div>
                <button class="action-btn btn-save" onclick="forceSave()">SAVE TO DATABASE</button>
                <button class="action-btn btn-retry" onclick="resetGame()">REPLAY (Keep XP)</button>
            </div>
        </div>
    </div>

    <script type="module" src="./system.js"></script>

    <script type="module">
        import { supabase } from './supabase.js';

        // --- Global Variables ---
        let currentUser = null;
        let currentGame = null;
        let gameActive = false;
        let gameLoopId = null;
        let currentRunXP = 0;
        let currentRunScore = 0;
        let unsavedVault = 0; // ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ© ŸÖÿ≠ŸÑŸäÿßŸã ŸàŸÑŸÖ ÿ™ÿ±ŸÅÿπ ÿ®ÿπÿØ
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        // --- Initialization ---
        function resizeGame() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
        window.addEventListener('resize', resizeGame);

        async function initPage() {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) { window.location.replace("login.html"); return; }
            currentUser = session.user;
            
            // Load User Info
            let { data: profile } = await supabase.from('users').select('*').eq('id', currentUser.id).single();
            document.getElementById('userName').innerText = profile?.name || "Player";
            document.getElementById('headerXp').innerText = (profile?.xp || 0).toLocaleString();
            
            document.getElementById('rocketHigh').innerText = localStorage.getItem('rocket_high') || 0;
            document.getElementById('snakeHigh').innerText = localStorage.getItem('snake_high') || 0;

            // Check Local Vault (ÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑŸÜŸÇÿßÿ∑ ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©)
            unsavedVault = parseInt(localStorage.getItem('skydata_unsaved_xp') || '0');
            updateVaultUI();
        }
        initPage();

        function updateVaultUI() {
            const alertBox = document.getElementById('unsavedAlert');
            const vaultSpan = document.getElementById('unsavedVal');
            const gameOverVault = document.getElementById('vaultXP');
            
            if (unsavedVault > 0) {
                alertBox.style.display = 'block';
                vaultSpan.innerText = unsavedVault;
                gameOverVault.innerText = unsavedVault;
            } else {
                alertBox.style.display = 'none';
                gameOverVault.innerText = 0;
            }
        }

        // --- Game Flow Control ---
        window.startGame = function(type) {
            currentGame = type;
            document.getElementById('gameModal').style.display = 'flex';
            document.getElementById('startOverlay').style.display = 'flex';
            document.getElementById('gameOverScreen').style.display = 'none';
            resizeGame();
        };

        window.initGameLogic = function() {
            document.getElementById('startOverlay').style.display = 'none';
            gameActive = true;
            currentRunXP = 0;
            currentRunScore = 0;
            if (currentGame === 'rocket') startRocketGame();
            else if (currentGame === 'snake') startSnakeGame();
        };

        window.exitGame = function() {
            gameActive = false;
            cancelAnimationFrame(gameLoopId);
            // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ≠ÿßŸÑŸäÿ© ŸÑŸÑÿÆÿ≤ŸÜÿ© ŸÇÿ®ŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨
            if (currentRunXP > 0) {
                unsavedVault += currentRunXP;
                localStorage.setItem('skydata_unsaved_xp', unsavedVault);
            }
            document.getElementById('gameModal').style.display = 'none';
            updateVaultUI();
        };

        // ÿ≤ÿ± ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÑÿπÿ® (Replay) - Ÿäÿ≠ŸÅÿ∏ ŸÖÿ≠ŸÑŸäÿßŸã ŸÅŸÇÿ∑
        window.resetGame = function() {
            // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÜŸÇÿßÿ∑ ŸÑŸÑÿÆÿ≤ŸÜÿ© ÿßŸÑŸÖÿ≠ŸÑŸäÿ©
            unsavedVault += currentRunXP;
            localStorage.setItem('skydata_unsaved_xp', unsavedVault);
            updateVaultUI();
            
            document.getElementById('gameOverScreen').style.display = 'none';
            initGameLogic();
        };

        // ÿ≤ÿ± ÿßŸÑÿ≠ŸÅÿ∏ (Save) - Ÿäÿ±ŸÅÿπ ŸÑŸÑÿ≥Ÿäÿ±ŸÅÿ± ŸàŸäÿµŸÅÿ± ÿßŸÑÿÆÿ≤ŸÜÿ©
        window.forceSave = async function() {
            // ŸÜÿ¨ŸÖÿπ ŸÜŸÇÿßÿ∑ ÿßŸÑÿ¨ŸàŸÑÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© + ŸÖÿß ŸÅŸä ÿßŸÑÿÆÿ≤ŸÜÿ©
            let totalToUpload = unsavedVault;
            if (document.getElementById('gameModal').style.display !== 'none' && !gameActive) {
                // ÿ•ÿ∞ÿß ŸÉŸÜÿß ŸÅŸä ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿÆÿ≥ÿßÿ±ÿ©ÿå ÿ£ÿ∂ŸÅ ŸÜŸÇÿßÿ∑ ÿßŸÑÿ¨ŸàŸÑÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ© ÿ£Ÿäÿ∂ÿßŸã
                totalToUpload += currentRunXP;
            }

            if (totalToUpload <= 0) return;

            const btn = document.querySelector('.btn-save');
            const originalText = btn.innerText;
            btn.innerText = "Syncing with Cloud...";
            
            try {
                let { data: profile } = await supabase.from('users').select('xp').eq('id', currentUser.id).single();
                let newTotal = (profile?.xp || 0) + totalToUpload;
                
                const { error } = await supabase.from('users').update({ xp: newTotal }).eq('id', currentUser.id);
                if (error) throw error;

                // ÿ™ÿµŸÅŸäÿ± ÿßŸÑÿÆÿ≤ŸÜÿ© ÿ®ÿπÿØ ÿßŸÑŸÜÿ¨ÿßÿ≠
                unsavedVault = 0;
                currentRunXP = 0;
                localStorage.setItem('skydata_unsaved_xp', 0);
                updateVaultUI();
                
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸáÿßŸäÿØÿ±
                document.getElementById('headerXp').innerText = newTotal.toLocaleString();
                
                // ÿßŸÑÿÆÿ±Ÿàÿ¨
                if (document.getElementById('gameModal').style.display !== 'none') {
                    window.location.href = "menu.html";
                } else {
                    btn.innerText = "Saved Successfully!";
                    setTimeout(() => btn.innerText = originalText, 2000);
                }

            } catch (err) {
                console.error(err);
                btn.innerText = "Failed! Try Again";
                alert("Internet Error: Points are safe in your browser. Try again.");
            }
        };

        function gameOver() {
            gameActive = false;
            cancelAnimationFrame(gameLoopId);
            
            // ÿ™ÿ≠ÿØŸäÿ´ ÿ£ÿπŸÑŸâ ŸÜÿ™Ÿäÿ¨ÿ© ŸÖÿ≠ŸÑŸäÿßŸã
            const key = currentGame + '_high';
            const oldHigh = parseInt(localStorage.getItem(key) || 0);
            if (currentRunScore > oldHigh) localStorage.setItem(key, currentRunScore);

            document.getElementById('finalScore').innerText = Math.floor(currentRunScore);
            document.getElementById('finalXP').innerText = Math.floor(currentRunXP);
            // ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ÿßŸÑŸÉŸÑŸä ÿßŸÑŸÖÿπŸÑŸÇ
            document.getElementById('vaultXP').innerText = unsavedVault + Math.floor(currentRunXP);
            
            document.getElementById('gameOverScreen').style.display = 'flex';
        }

        // ==========================================
        // üöÄ GAME 1: ROCKET (IMPROVED GRAPHICS)
        // ==========================================
        let rocket = { x: 0, y: 0, w: 40, h: 60 };
        let obstacles = [];
        let items = [];
        let effects = []; // For explosions/particles
        let gameTime = 0;
        let shieldActive = false;
        let shieldTimer = 0;
        let speedFactor = 1;
        let mouse = { x: width/2, y: height/2 };

        // Load Icons from FontAwesome (drawn on canvas)
        function drawIcon(icon, x, y, size, color, rotation = 0) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation);
            ctx.fillStyle = color;
            ctx.font = `${size}px "Font Awesome 6 Free"`;
            ctx.font = `${size}px "Font Awesome 6 Brands"`; 
            // Note: Canvas needs FontAwesome Loaded. We use unicode.
            // Rocket: \uf135, Meteor: \uf185 (Sun-like) or \uf06d (Fire) - Let's use shapes for meteors for better rotation
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(icon, 0, 0);
            ctx.restore();
        }

        // Input
        function updateInput(x, y) { mouse.x = x; mouse.y = y; }
        canvas.addEventListener('mousemove', e => updateInput(e.clientX, e.clientY));
        canvas.addEventListener('touchmove', e => { e.preventDefault(); updateInput(e.touches[0].clientX, e.touches[0].clientY); }, {passive: false});

        function startRocketGame() {
            rocket.x = width/2; rocket.y = height - 150;
            obstacles = []; items = []; effects = [];
            gameTime = 0; speedFactor = 1; shieldActive = false;
            
            function loop() {
                if(!gameActive) return;
                updateRocket();
                drawRocketGame();
                gameLoopId = requestAnimationFrame(loop);
            }
            loop();
        }

        function updateRocket() {
            gameTime++;
            
            // Smooth Difficulty: Start slow, increase every 10s (600 frames)
            if (gameTime % 600 === 0) speedFactor += 0.2;
            const currentSpeed = (2 + (gameTime/1000)) * speedFactor;

            // Rocket Physics
            rocket.x += (mouse.x - rocket.x) * 0.12;
            rocket.y += (mouse.y - rocket.y) * 0.12;

            // Spawn Meteors (Better distribution)
            if (gameTime % Math.max(30, Math.floor(80/speedFactor)) === 0) {
                const size = Math.random() * 30 + 30; // 30-60px
                const xPos = Math.random() * (width - size);
                
                // Prevent overlapping spawn
                let safe = true;
                obstacles.forEach(o => { if (Math.abs(o.x - xPos) < size + 10 && o.y < 100) safe = false; });
                
                if (safe) {
                    obstacles.push({
                        x: xPos, y: -100, size: size,
                        speed: currentSpeed + Math.random(),
                        rot: Math.random() * 6.28, rotSpeed: (Math.random()-0.5) * 0.1
                    });
                }
            }

            // Spawn Items (Powerups)
            if (gameTime % 300 === 0) {
                const r = Math.random();
                let type = 'fuel'; // ‚õΩ
                if (r < 0.05) type = 'shield'; // üõ°Ô∏è 5%
                else if (r < 0.2) type = 'gem'; // üíé 15%
                items.push({ x: Math.random() * (width - 40), y: -50, type: type, speed: currentSpeed });
            }

            // Logic loops
            obstacles.forEach((o, i) => {
                o.y += o.speed; o.rot += o.rotSpeed;
                if(o.y > height) { obstacles.splice(i, 1); currentRunXP += 1; }
                
                // Collision
                const dist = Math.hypot(rocket.x - o.x, rocket.y - o.y);
                if (dist < (30 + o.size/2.5)) {
                    if (shieldActive) {
                        // Shield Block Effect
                        effects.push({x: o.x, y: o.y, type: 'shockwave', life: 20});
                        obstacles.splice(i, 1);
                        currentRunXP += 10;
                    } else {
                        gameOver();
                    }
                }
            });

            items.forEach((it, i) => {
                it.y += it.speed;
                if(it.y > height) items.splice(i, 1);
                if (Math.hypot(rocket.x - it.x, rocket.y - it.y) < 40) {
                    if(it.type === 'shield') { shieldActive = true; shieldTimer = 900; currentRunXP += 100; }
                    else if(it.type === 'gem') currentRunXP += 50;
                    else currentRunXP += 10;
                    items.splice(i, 1);
                }
            });

            // Shield Timer
            if (shieldActive) {
                shieldTimer--;
                document.getElementById('shieldStatus').style.display = 'block';
                if (shieldTimer <= 0) { shieldActive = false; document.getElementById('shieldStatus').style.display = 'none'; }
            }

            currentRunScore = Math.floor(gameTime / 10);
            document.getElementById('gameScore').innerText = currentRunScore;
            document.getElementById('gameXP').innerText = Math.floor(currentRunXP);
        }

        function drawRocketGame() {
            ctx.clearRect(0, 0, width, height);

            // Draw Stars (Warp Speed)
            ctx.fillStyle = 'rgba(255,255,255,0.8)';
            for(let i=0; i<50; i++) {
                let sY = (Date.now() * (0.2 + i*0.01)) % height;
                let sX = (i * 137) % width;
                ctx.beginPath(); ctx.arc(sX, sY, Math.random()*2, 0, Math.PI*2); ctx.fill();
            }

            // Draw Meteors (Shapes for performance & look)
            ctx.fillStyle = '#555';
            ctx.strokeStyle = '#222';
            obstacles.forEach(o => {
                ctx.save();
                ctx.translate(o.x, o.y);
                ctx.rotate(o.rot);
                // Draw Rock Shape
                ctx.beginPath();
                ctx.moveTo(-o.size/2, -o.size/2);
                ctx.lineTo(o.size/2, -o.size/2 + 10);
                ctx.lineTo(o.size/2 - 5, o.size/2);
                ctx.lineTo(-o.size/2 + 5, o.size/2 - 5);
                ctx.closePath();
                ctx.fillStyle = '#6e6e6e'; ctx.fill(); ctx.stroke();
                // Crater
                ctx.beginPath(); ctx.arc(5, -5, o.size/6, 0, Math.PI*2); ctx.fillStyle='rgba(0,0,0,0.2)'; ctx.fill();
                ctx.restore();
            });

            // Draw Items (Unicode Icons)
            ctx.textAlign = "center"; ctx.textBaseline = "middle";
            items.forEach(it => {
                let icon = "‚õΩ";
                if(it.type === 'shield') icon = "üõ°Ô∏è";
                if(it.type === 'gem') icon = "üíé";
                ctx.font = "30px Arial";
                ctx.fillText(icon, it.x, it.y);
            });

            // Draw Rocket
            ctx.save();
            ctx.translate(rocket.x, rocket.y);
            
            // Shield Visuals (Blue Bubble)
            if (shieldActive) {
                // Flash in last 3 seconds (180 frames)
                if (shieldTimer > 180 || Math.floor(Date.now() / 100) % 2 === 0) {
                    ctx.beginPath();
                    ctx.arc(0, 0, 50, 0, Math.PI*2);
                    ctx.fillStyle = 'rgba(0, 242, 255, 0.2)';
                    ctx.strokeStyle = 'rgba(0, 242, 255, 0.8)';
                    ctx.lineWidth = 2;
                    ctx.fill(); ctx.stroke();
                }
            }

            // Engine Flame
            ctx.fillStyle = (gameTime % 4 === 0) ? '#ff5722' : '#ff9800';
            ctx.beginPath();
            ctx.moveTo(-10, 20); ctx.lineTo(0, 45 + Math.random()*10); ctx.lineTo(10, 20);
            ctx.fill();

            // Rocket Body (Using FontAwesome Unicode or Simple Drawing)
            // Using text is safer for cross-origin issues
            ctx.font = "50px Arial";
            ctx.fillText("üöÄ", 0, 0);
            ctx.restore();

            // Draw Effects (Shockwaves)
            for(let i=effects.length-1; i>=0; i--) {
                let e = effects[i];
                ctx.beginPath();
                ctx.arc(e.x, e.y, 20 + (20 - e.life)*3, 0, Math.PI*2);
                ctx.strokeStyle = `rgba(0, 242, 255, ${e.life/20})`;
                ctx.lineWidth = 4;
                ctx.stroke();
                e.life--;
                if(e.life <= 0) effects.splice(i,1);
            }
        }

        // ==========================================
        // üêç SNAKE (Classic - Same Logic)
        // ==========================================
        const gridSize = 20;
        let snake = []; let food = {};
        let direction = 'RIGHT'; let nextDirection = 'RIGHT';
        let snakeSpeed = 10; let snakeFrame = 0;

        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowUp' && direction !== 'DOWN') nextDirection = 'UP';
            else if (e.key === 'ArrowDown' && direction !== 'UP') nextDirection = 'DOWN';
            else if (e.key === 'ArrowLeft' && direction !== 'RIGHT') nextDirection = 'LEFT';
            else if (e.key === 'ArrowRight' && direction !== 'LEFT') nextDirection = 'RIGHT';
        });

        let touchStartX = 0; let touchStartY = 0;
        canvas.addEventListener('touchstart', e => { touchStartX = e.touches[0].clientX; touchStartY = e.touches[0].clientY; }, {passive: false});
        canvas.addEventListener('touchend', e => {
            let dx = e.changedTouches[0].clientX - touchStartX;
            let dy = e.changedTouches[0].clientY - touchStartY;
            if (Math.abs(dx) > Math.abs(dy)) { if (dx > 0 && direction !== 'LEFT') nextDirection = 'RIGHT'; else if (dx < 0 && direction !== 'RIGHT') nextDirection = 'LEFT'; } 
            else { if (dy > 0 && direction !== 'UP') nextDirection = 'DOWN'; else if (dy < 0 && direction !== 'DOWN') nextDirection = 'UP'; }
        });

        function startSnakeGame() {
            snake = [{x: 10, y: 10}, {x: 9, y: 10}, {x: 8, y: 10}];
            placeFood(); direction = 'RIGHT'; nextDirection = 'RIGHT'; snakeSpeed = 10;
            function loop() {
                if(!gameActive) return;
                snakeFrame++;
                if (snakeFrame >= snakeSpeed) { snakeFrame = 0; updateSnake(); }
                drawSnake();
                gameLoopId = requestAnimationFrame(loop);
            }
            loop();
        }

        function placeFood() { food = { x: Math.floor(Math.random() * (width / gridSize)), y: Math.floor(Math.random() * (height / gridSize)) }; }

        function updateSnake() {
            direction = nextDirection;
            const head = { ...snake[0] };
            if (direction === 'UP') head.y--; else if (direction === 'DOWN') head.y++; else if (direction === 'LEFT') head.x--; else if (direction === 'RIGHT') head.x++;
            if (head.x < 0 || head.x >= width/gridSize || head.y < 0 || head.y >= height/gridSize) { gameOver(); return; }
            for(let cell of snake) if (cell.x === head.x && cell.y === head.y) { gameOver(); return; }
            snake.unshift(head);
            if (head.x === food.x && head.y === food.y) {
                currentRunXP += 5; currentRunScore++;
                if (currentRunScore % 5 === 0 && snakeSpeed > 3) snakeSpeed--;
                placeFood();
            } else snake.pop();
            document.getElementById('gameScore').innerText = currentRunScore;
            document.getElementById('gameXP').innerText = currentRunXP;
        }

        function drawSnake() {
            ctx.fillStyle = '#0a0a12'; ctx.fillRect(0, 0, width, height);
            ctx.fillStyle = '#00e676';
            snake.forEach(cell => ctx.fillRect(cell.x * gridSize + 1, cell.y * gridSize + 1, gridSize-2, gridSize-2));
            ctx.font = "20px Arial"; ctx.textAlign = "center"; ctx.textBaseline = "middle";
            ctx.fillText("üçå", food.x * gridSize + gridSize/2, food.y * gridSize + gridSize/2);
        }
    </script>
</body>
</html>